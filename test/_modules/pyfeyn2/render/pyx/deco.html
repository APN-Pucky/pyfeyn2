

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyfeyn2.render.pyx.deco &mdash; pyfeyn2  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> pyfeyn2
          

          
          </a>

          
            
            
              <div class="version">
                2.0.3-4-g12148f4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Versions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/pyfeyn2/">Stable</a></li>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/pyfeyn2/test/">Dev</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/APN-Pucky/pyfeyn2">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FeynML:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../feynml/index.html">FeynML</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/ASCII.html">ASCII</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/All.html">All</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/Dot.html">Dot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/FeynML.html">FeynML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/FeynMP.html">FeynMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/MPL.html">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/PyX.html">PyX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/tikzfeynman.html">TIKZ-Feynman</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">pyfeyn2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyfeyn2.render.pyx.deco</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyfeyn2.render.pyx.deco</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;A couple of classes for decorating diagram elements.&quot;&quot;&quot;

import math

import pyx

from pyfeyn2.render.pyx import config
from pyfeyn2.render.pyx.diagrams import FeynDiagram
from pyfeyn2.render.pyx.utils import Visible

###########################################################################################
## Added by George S. Williams to allow PyFeyn to work with PyX versions 0.12.x and 0.11.x
## Also see changes in class Arrow and class ParallelArrow


<div class="viewcode-block" id="getarrowpath"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.getarrowpath">[docs]</a>def getarrowpath(
    arrowtopath, selfpos, var1, selfsize, var2, selfconstriction, constrictionlen
):
    arrowpath = pyx.deco._arrowhead(
        arrowtopath, selfpos, var1, selfsize, var2, selfconstriction, constrictionlen
    )
    return arrowpath</div>


###########################################################################################


## Arrow decorator class
<div class="viewcode-block" id="Arrow"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.Arrow">[docs]</a>class Arrow(pyx.deco.deco, pyx.attr.attr):
    &quot;&quot;&quot;Arrow for Feynman diagram lines&quot;&quot;&quot;

    def __init__(self, pos=0.5, size=6 * pyx.unit.v_pt, angle=45, constriction=0.8):
        &quot;&quot;&quot;Constructor.&quot;&quot;&quot;
        self.pos = pos
        self.size = size
        self.angle = angle
        self.constriction = constriction

<div class="viewcode-block" id="Arrow.decorate"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.Arrow.decorate">[docs]</a>    def decorate(self, dp):
        &quot;&quot;&quot;Attach arrow to a path (usually a line).&quot;&quot;&quot;
        dp.ensurenormpath()
        constrictionlen = (
            self.size * self.constriction * math.cos(self.angle * math.pi / 360.0)
        )
        arrowtopos = self.pos * dp.path.arclen() + 0.5 * self.size
        arrowtopath = dp.path.split(arrowtopos)[0]
        arrowpath = getarrowpath(
            arrowtopath,
            self.pos * dp.path.arclen(),
            1,
            self.size,
            45,
            self.constriction,
            constrictionlen,
        )
        dp.ornaments.fill(arrowpath)
        return dp</div></div>


<div class="viewcode-block" id="FreeArrow"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.FreeArrow">[docs]</a>class FreeArrow(Visible):
    &quot;&quot;&quot;Arrow not attached to any line in a diagram.&quot;&quot;&quot;

    def __init__(
        self,
        length=0.5 * pyx.unit.v_cm,
        size=6 * pyx.unit.v_pt,
        angle=45,
        constriction=0.8,
        pos=None,
        x=None,
        y=None,
        direction=0,
    ):
        &quot;&quot;&quot;Constructor.&quot;&quot;&quot;
        self.x, self.y = 0, 0
        if x is not None:
            self.x = x
        if y is not None:
            self.y = y
        if pos is not None:
            self.x, self.y = pos.getXY()
        self.direction = direction
        self.length = length
        self.size = size
        self.angle = angle
        self.constriction = constriction
        ## Add this to the current diagram automatically
        FeynDiagram.currentDiagram.add(self)

<div class="viewcode-block" id="FreeArrow.draw"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.FreeArrow.draw">[docs]</a>    def draw(self, canvas):
        &quot;&quot;&quot;Draw this arrow on the supplied canvas.&quot;&quot;&quot;
        endx, endy = self.x - self.length * math.sin(
            self.direction * math.pi / 180.0
        ), self.y - self.length * math.cos(self.direction * math.pi / 180.0)
        linepath = pyx.deco.decoratedpath(
            pyx.path.path(pyx.path.moveto(endx, endy), pyx.path.lineto(self.x, self.y))
        )
        styles = [
            pyx.deco.earrow(
                size=self.size, angle=self.angle, constriction=self.constriction
            )
        ]
        canvas.stroke(linepath.path, styles)</div></div>


<div class="viewcode-block" id="ParallelArrow"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.ParallelArrow">[docs]</a>class ParallelArrow(Visible):
    &quot;&quot;&quot;Arrow running parallel to a line, for momenta, helicities etc.&quot;&quot;&quot;

    def __init__(
        self,
        line,
        pos=0.5,
        displace=0.3,
        length=0.5 * pyx.unit.v_cm,
        size=6 * pyx.unit.v_pt,
        angle=45,
        constriction=0.8,
        sense=+1,
        curved=False,
        stems=1,
        stemsep=0.03,
    ):
        &quot;&quot;&quot;Constructor.&quot;&quot;&quot;
        self.line = line
        self.pos = pos
        self.displace = pyx.unit.length(displace)
        self.length = length
        self.size = size
        self.angle = angle
        self.constriction = constriction
        self.sense = sense
        self.curved = curved
        self.stems = stems
        self.stemsep = stemsep

<div class="viewcode-block" id="ParallelArrow.draw"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.ParallelArrow.draw">[docs]</a>    def draw(self, canvas):
        &quot;&quot;&quot;Draw this arrow on the supplied canvas.&quot;&quot;&quot;
        p = self.line.getPath()
        posparam = p.begin() + self.pos * p.arclen()
        x, y = self.line.fracpoint(self.pos).getXY()
        arrx, arry = self.line.fracpoint(
            self.pos + self.length / 2.0 / p.arclen()
        ).getXY()
        endx, endy = self.line.fracpoint(
            self.pos - self.length / 2.0 / p.arclen()
        ).getXY()

        ## Calculate the displacement from the line
        displacement = self.displace
        intrinsicwidth = pyx.unit.length(0.1)
        if hasattr(self.line, &quot;arcradius&quot;):
            intrinsicwidth = self.line.arcradius
        if displacement &gt; 0:
            displacement += intrinsicwidth
        else:
            displacement -= intrinsicwidth
        if config.getOptions().DEBUG:
            print(&quot;Displacement = &quot;, displacement)

        ## Position the arrow on the right hand side of lines
        tangent = p.tangent(posparam, displacement)
        normal = tangent.transformed(pyx.trafo.rotate(90, x, y))
        nx, ny = normal.atend()
        nxcm, nycm = pyx.unit.tocm(nx - x), pyx.unit.tocm(ny - y)
        vx, vy = p.atbegin()
        vxcm, vycm = pyx.unit.tocm(x - vx), pyx.unit.tocm(y - vy)

        ## If the arrow is on the left, flip it by 180 degrees
        if (vxcm * nycm - vycm * nxcm) &gt; 0:
            normal = normal.transformed(pyx.trafo.rotate(180, x, y))
            nx, ny = normal.atend()
        if displacement &lt; 0:
            normal = normal.transformed(pyx.trafo.rotate(180, x, y))
            nx, ny = normal.atend()
        if config.getOptions().VDEBUG:
            FeynDiagram.currentDiagram.currentCanvas.stroke(normal)

        ## Displace the arrow by this normal vector
        endx, endy = endx + (nx - x), endy + (ny - y)
        arrx, arry = arrx + (nx - x), arry + (ny - y)

        if self.sense &lt; 0.0:
            arrx, arry, endx, endy = endx, endy, arrx, arry

        if not self.curved:
            linepath = pyx.path.path(
                pyx.path.moveto(endx, endy), pyx.path.lineto(arrx, arry)
            )
            styles = [
                pyx.deco.earrow(
                    size=self.size, angle=self.angle, constriction=self.constriction
                )
            ]
            dist = self.stemsep
            n = self.stems
            if n &gt; 1:  # helicity style arrow
                arrowtopath = linepath.split(0.8 * linepath.arclen())[0]
                constrictionlen = (
                    self.size
                    * self.constriction
                    * math.cos(self.angle * math.pi / 360.0)
                )
                arrowpath = getarrowpath(
                    arrowtopath,
                    linepath.arclen(),
                    1,
                    self.size,
                    45,
                    self.constriction,
                    constrictionlen,
                )
                canvas.fill(arrowpath)
                path = pyx.deformer.parallel(-(n + 1) / 2.0 * dist).deform(arrowtopath)
                defo = pyx.deformer.parallel(dist)
                for m in range(n):
                    path = defo.deform(path)
                    canvas.stroke(path, [])
            else:  # ordinary (momentum) arrow
                canvas.stroke(linepath, styles)
        else:  # curved arrow (always momentum-style)
            curvepiece = self.line.getPath().split(
                [
                    (self.pos * p.arclen() - self.length / 2.0),
                    (self.pos * p.arclen() + self.length / 2.0),
                ]
            )
            arrpiece = curvepiece[1]
            if self.sense &lt; 0:
                arrpiece = arrpiece.reversed()
            linepath = pyx.deco.decoratedpath(
                pyx.deformer.parallel(displacement).deform(arrpiece)
            )
            styles = [
                pyx.deco.earrow(
                    size=self.size, angle=self.angle, constriction=self.constriction
                )
            ]
            canvas.stroke(linepath.path, styles)</div></div>


## Label
<div class="viewcode-block" id="Label"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.Label">[docs]</a>class Label(Visible):
    &quot;&quot;&quot;General label, unattached to any diagram elements&quot;&quot;&quot;

    def __init__(self, text, pos=None, x=None, y=None, size=pyx.text.size.normalsize):
        &quot;&quot;&quot;Constructor.&quot;&quot;&quot;
        self.x, self.y = 0, 0
        if x is not None:
            self.x = x
        if y is not None:
            self.y = y
        self.size = size
        self.text = text
        self.textattrs = []
        self.pos = pos

        ## Add this to the current diagram automatically
        FeynDiagram.currentDiagram.add(self)

<div class="viewcode-block" id="Label.draw"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.Label.draw">[docs]</a>    def draw(self, canvas):
        &quot;&quot;&quot;Draw this label on the supplied canvas.&quot;&quot;&quot;
        textattrs = pyx.attr.mergeattrs(
            [pyx.text.halign.center, pyx.text.vshift.mathaxis, self.size]
            + self.textattrs
        )
        t = pyx.text.latexrunner().text(self.x, self.y, self.text, textattrs)
        canvas.insert(t)</div></div>


## PointLabel
<div class="viewcode-block" id="PointLabel"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.PointLabel">[docs]</a>class PointLabel(Label):
    &quot;&quot;&quot;Label attached to points on the diagram&quot;&quot;&quot;

    def __init__(
        self, point, text, displace=0.3, angle=0, size=pyx.text.size.normalsize
    ):
        &quot;&quot;&quot;Constructor.&quot;&quot;&quot;
        self.size = size
        self.displace = pyx.unit.length(displace)
        self.angle = angle
        self.text = text
        self.point = point
        self.textattrs = []

<div class="viewcode-block" id="PointLabel.getPoint"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.PointLabel.getPoint">[docs]</a>    def getPoint(self):
        &quot;&quot;&quot;Get the point associated with this label.&quot;&quot;&quot;
        return self.point</div>

<div class="viewcode-block" id="PointLabel.setPoint"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.PointLabel.setPoint">[docs]</a>    def setPoint(self, point):
        &quot;&quot;&quot;Set the point associated with this label.&quot;&quot;&quot;
        self.point = point
        return self</div>

<div class="viewcode-block" id="PointLabel.draw"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.PointLabel.draw">[docs]</a>    def draw(self, canvas):
        &quot;&quot;&quot;Draw this label on the supplied canvas.&quot;&quot;&quot;
        if config.getOptions().VDEBUG:
            canvas.fill(
                pyx.path.circle(self.point.getX(), self.point.getY(), 0.05),
                [pyx.color.rgb.green],
            )
        x = self.point.getX() + self.displace * math.cos(math.radians(self.angle))
        y = self.point.getY() + self.displace * math.sin(math.radians(self.angle))
        textattrs = pyx.attr.mergeattrs(
            [pyx.text.halign.center, pyx.text.vshift.mathaxis, self.size]
            + self.textattrs
        )
        t = pyx.text.latexrunner().text(x, y, self.text, textattrs)
        canvas.insert(t)</div></div>


## LineLabel
<div class="viewcode-block" id="LineLabel"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.LineLabel">[docs]</a>class LineLabel(Label):
    &quot;&quot;&quot;Label for Feynman diagram lines&quot;&quot;&quot;

    def __init__(
        self, line, text, pos=0.5, displace=0.3, angle=0, size=pyx.text.size.normalsize
    ):
        &quot;&quot;&quot;Constructor.&quot;&quot;&quot;
        self.pos = pos
        self.size = size
        self.displace = pyx.unit.length(displace)
        self.angle = angle
        self.text = text
        self.line = line
        self.textattrs = []

<div class="viewcode-block" id="LineLabel.getLine"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.LineLabel.getLine">[docs]</a>    def getLine(self):
        &quot;&quot;&quot;Get the associated line.&quot;&quot;&quot;
        return self.line</div>

<div class="viewcode-block" id="LineLabel.setLine"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.LineLabel.setLine">[docs]</a>    def setLine(self, line):
        &quot;&quot;&quot;Set the associated line.&quot;&quot;&quot;
        self.line = line
        return self</div>

<div class="viewcode-block" id="LineLabel.draw"><a class="viewcode-back" href="../../../../autoapi/pyfeyn2/render/pyx/deco/index.html#pyfeyn2.render.pyx.deco.LineLabel.draw">[docs]</a>    def draw(self, canvas):
        &quot;&quot;&quot;Draw this label on the supplied canvas.&quot;&quot;&quot;
        p = self.line.getPath()
        # x, y = self.line.fracPoint(self.pos).getXY()
        posparam = p.begin() + self.pos * p.arclen()
        x, y = p.at(posparam)

        ## Calculate the displacement from the line
        displacement = self.displace
        intrinsicwidth = pyx.unit.length(0.1)
        if hasattr(self.line, &quot;arcradius&quot;):
            intrinsicwidth = self.line.arcradius
        if displacement &gt; 0:
            displacement += intrinsicwidth
        else:
            displacement -= intrinsicwidth
        if config.getOptions().DEBUG:
            print(&quot;Displacement = &quot;, displacement)

        ## Position the label on the right hand side of lines
        tangent = p.tangent(posparam, displacement)
        normal = tangent.transformed(pyx.trafo.rotate(90, x, y))
        nx, ny = normal.atend()
        nxcm, nycm = pyx.unit.tocm(nx - x), pyx.unit.tocm(ny - y)
        vx, vy = p.atbegin()
        vxcm, vycm = pyx.unit.tocm(x - vx), pyx.unit.tocm(y - vy)

        ## If the label is on the left, flip it by 180 degrees
        if (vxcm * nycm - vycm * nxcm) &gt; 0:
            normal = normal.transformed(pyx.trafo.rotate(180, x, y))
            nx, ny = normal.atend()
        if displacement &lt; 0:
            normal = normal.transformed(pyx.trafo.rotate(180, x, y))
            nx, ny = normal.atend()
        if config.getOptions().VDEBUG:
            FeynDiagram.currentDiagram.currentCanvas.stroke(normal)

        ## Displace the label by this normal vector
        x, y = nx, ny

        textattrs = pyx.attr.mergeattrs(
            [pyx.text.halign.center, pyx.text.vshift.mathaxis, self.size]
            + self.textattrs
        )
        t = pyx.text.latexrunner().text(x, y, self.text, textattrs)
        # t.linealign(self.displace,
        #            math.cos(self.angle * math.pi/180),
        #            math.sin(self.angle * math.pi/180))
        canvas.insert(t)</div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Alexander Puck Neuwirth.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>