<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyfeyn2.feynmandiagram &mdash; pyfeyn2  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pyfeyn2
            <img src="../../_static/pyfeyn-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.1.0-13-g37ba9eaa
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Versions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/pyfeyn2/">Stable</a></li>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/pyfeyn2/test/">Dev</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/APN-Pucky/pyfeyn2">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FeynML:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../feynml/index.html">FeynML</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/index.html">Gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Renderers:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../renderers/index.html">Renderers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfaces:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../interfaces/index.html">Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/pyfeyn2.html">pyfeyn2</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyfeyn2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyfeyn2.feynmandiagram</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyfeyn2.feynmandiagram</h1><div class="highlight"><pre>
<span></span>import logging
import warnings
from dataclasses import dataclass, field
from importlib.metadata import version
from typing import List, Optional, Union

import cssutils
from cssselect import GenericTranslator, SelectorError
from lxml import etree
from particle import Particle
from xsdata.formats.converter import Converter, converter
from xsdata.formats.dataclass.parsers import XmlParser
from xsdata.formats.dataclass.serializers import XmlSerializer
from xsdata.formats.dataclass.serializers.config import SerializerConfig

from pyfeyn2.particles import get_either_particle
from pyfeyn2.types import get_default_sheet
from pyfeyn2.util import deprecated, withify

# We don&#39;t want to see the cssutils warnings, since we have custom properties
cssutils.log.setLevel(logging.CRITICAL)


# from pyfeyn2.propagator import Propagator
# from pyfeyn2.vertex import Vertex

# Global counter for unique ids
global_id = 0


<div class="viewcode-block" id="Identifiable"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Identifiable.html#pyfeyn2.feynmandiagram.Identifiable">[docs]</a>@withify()
@dataclass
class Identifiable:
    id: Optional[str] = field(
        default=None, metadata={&quot;name&quot;: &quot;id&quot;, &quot;namespace&quot;: &quot;&quot;, &quot;type&quot;: &quot;Attribute&quot;}
    )
    # id2: Optional[str] = field(default=None, metadata={&quot;name&quot;: &quot;id2&quot;, &quot;namespace&quot;: &quot;&quot;})

    def __post_init__(self):
        global global_id
        if self.id is None:
            # use some global counter to generate unique id
            self.id = self.__class__.__name__ + str(global_id)
            global_id = global_id + 1</div>


<div class="viewcode-block" id="PDG"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.PDG.html#pyfeyn2.feynmandiagram.PDG">[docs]</a>@withify()
@dataclass
class PDG(Identifiable):
    pdgid: Optional[int] = field(
        default=None, metadata={&quot;name&quot;: &quot;pdgid&quot;, &quot;namespace&quot;: &quot;&quot;, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;PDG ID of the particle&quot;&quot;&quot;
    name: Optional[str] = field(default=None, metadata={&quot;type&quot;: &quot;Element&quot;})
    &quot;&quot;&quot;Name of the particle&quot;&quot;&quot;
    type: Optional[str] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;Type of the particle, e.g. fermion, boson, etc.&quot;&quot;&quot;

    # TODO check SUSY
    particle: Optional[Particle] = field(default=None, metadata={&quot;type&quot;: &quot;Ignore&quot;})
    &quot;&quot;&quot;Particle object from the particle package&quot;&quot;&quot;

    def _sync(self):
        &quot;&quot;&quot;Sync the particle with the pdgid, name etc.&quot;&quot;&quot;
        if self.pdgid is not None:
            self.particle = Particle.from_pdgid(self.pdgid)
            self.name = self.particle.name
        elif self.name is not None:
            self.particle = get_either_particle(
                programmatic_name=self.name,
                name=self.name,
                evtgen_name=self.name,
                html_name=self.name,
                latex_name=self.name,
            )
            if self.particle is None:
                raise ValueError(f&quot;Particle {self.name} not found&quot;)
            self.pdgid = int(self.particle.pdgid)

        if self.pdgid is not None:
            tmptype = self.type
            # TODO infere type from pdgid
            if self.pdgid in range(1, 7):
                self.type = &quot;fermion&quot;
            elif -self.pdgid in range(1, 7):
                self.type = &quot;anti fermion&quot;
            elif self.pdgid == 22:
                self.type = &quot;photon&quot;
            elif self.pdgid == 21:
                self.type = &quot;gluon&quot;
            elif self.pdgid in range(11, 19):
                self.type = &quot;fermion&quot;
            elif -self.pdgid in range(11, 19):
                self.type = &quot;anti fermion&quot;
            elif abs(self.pdgid) == 24:
                self.type = &quot;boson&quot;
            elif self.pdgid == 23:
                self.type = &quot;boson&quot;
            elif self.pdgid == 25:
                self.type = &quot;higgs&quot;
            else:
                warnings.warn(
                    f&quot;Inferring type from pdgid not implemented for pdgid {self.pdgid} &quot;
                )
                self.type = &quot;line&quot;
            if tmptype is not None and self.type != tmptype:
                warnings.warn(
                    f&quot;Type {tmptype} is not consistent with pdgid {self.pdgid}, using {self.type} instead. Using {tmptype} now.&quot;
                )
                self.type = tmptype

    def __post_init__(self):
        super().__post_init__()
        self._sync()

    # def with_pdgid(self, pdgid):
    #    self.pdgid = pdgid
    #    self._sync()
    #    return self

    # def with_name(self, name):
    #    self.name = name
    #    self._sync()
    #    return self

<div class="viewcode-block" id="PDG.set_pdgig"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.PDG.html#pyfeyn2.feynmandiagram.PDG.set_pdgig">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_pdgig(self, *args, **kwargs):
        return self.with_pdgid(*args, **kwargs)</div>

<div class="viewcode-block" id="PDG.set_type"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.PDG.html#pyfeyn2.feynmandiagram.PDG.set_type">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_type(self, *args, **kwargs):
        return self.with_type(*args, **kwargs)</div>

<div class="viewcode-block" id="PDG.set_name"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.PDG.html#pyfeyn2.feynmandiagram.PDG.set_name">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_name(self, *args, **kwargs):
        return self.with_name(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Labeled"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Labeled.html#pyfeyn2.feynmandiagram.Labeled">[docs]</a>@withify()
@dataclass
class Labeled:
    label: Optional[str] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;Label the object&quot;&quot;&quot;

<div class="viewcode-block" id="Labeled.set_label"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Labeled.html#pyfeyn2.feynmandiagram.Labeled.set_label">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_label(self, *args, **kwargs):
        return self.with_label(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Texted"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Texted.html#pyfeyn2.feynmandiagram.Texted">[docs]</a>@withify()
@dataclass
class Texted:
    text: Optional[str] = field(
        default=&quot;&quot;, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;Text the object&quot;&quot;&quot;

<div class="viewcode-block" id="Texted.set_text"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Texted.html#pyfeyn2.feynmandiagram.Texted.set_text">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&#39;Use label=&quot;&quot;&#39;)
    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_text(self, *args, **kwargs):
        return self.with_text(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Point.html#pyfeyn2.feynmandiagram.Point">[docs]</a>@dataclass
class Point:
    x: Optional[float] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;x coordinate&quot;&quot;&quot;
    y: Optional[float] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;y coordinate&quot;&quot;&quot;
    z: Optional[float] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;z coordinate&quot;&quot;&quot;

    def with_point(self, p):
        self.x = float(p.x)
        self.y = float(p.y)
        return self

    def with_xy(self, x, y):
        self.x = float(x)
        self.y = float(y)
        return self

    def with_xyz(self, x, y, z):
        self.x = float(x)
        self.y = float(y)
        self.z = float(z)
        return self

<div class="viewcode-block" id="Point.set_point"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Point.html#pyfeyn2.feynmandiagram.Point.set_point">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_point(self, *args, **kwargs):
        return self.with_point(*args, **kwargs)</div>

<div class="viewcode-block" id="Point.set_xy"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Point.html#pyfeyn2.feynmandiagram.Point.set_xy">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_xy(self, *args, **kwargs):
        return self.with_xy(*args, **kwargs)</div>

<div class="viewcode-block" id="Point.set_xyz"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Point.html#pyfeyn2.feynmandiagram.Point.set_xyz">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_xyz(self, *args, **kwargs):
        return self.with_xyz(*args, **kwargs)</div></div>


CSSString = cssutils.css.CSSStyleDeclaration
CSSSheet = cssutils.css.CSSStyleSheet


<div class="viewcode-block" id="CSSStringConverter"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.CSSStringConverter.html#pyfeyn2.feynmandiagram.CSSStringConverter">[docs]</a>class CSSStringConverter(Converter):
<div class="viewcode-block" id="CSSStringConverter.deserialize"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.CSSStringConverter.html#pyfeyn2.feynmandiagram.CSSStringConverter.deserialize">[docs]</a>    @staticmethod
    def deserialize(value: str, **kwargs) -&gt; CSSString:
        return cssutils.parseStyle(value)</div>

<div class="viewcode-block" id="CSSStringConverter.serialize"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.CSSStringConverter.html#pyfeyn2.feynmandiagram.CSSStringConverter.serialize">[docs]</a>    @staticmethod
    def serialize(value: CSSString, **kwargs) -&gt; str:
        return value.cssText.replace(&quot;\n&quot;, &quot; &quot;)</div></div>


<div class="viewcode-block" id="CSSSheetConverter"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.CSSSheetConverter.html#pyfeyn2.feynmandiagram.CSSSheetConverter">[docs]</a>class CSSSheetConverter(Converter):
<div class="viewcode-block" id="CSSSheetConverter.deserialize"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.CSSSheetConverter.html#pyfeyn2.feynmandiagram.CSSSheetConverter.deserialize">[docs]</a>    @staticmethod
    def deserialize(value: str, **kwargs) -&gt; CSSSheet:
        return cssutils.parseString(value)</div>

<div class="viewcode-block" id="CSSSheetConverter.serialize"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.CSSSheetConverter.html#pyfeyn2.feynmandiagram.CSSSheetConverter.serialize">[docs]</a>    @staticmethod
    def serialize(value: CSSSheet, **kwargs) -&gt; str:
        return value.cssText.decode(&quot;utf-8&quot;)  # .replace(&quot;\n&quot;, &quot; &quot;)</div></div>


converter.register_converter(CSSString, CSSStringConverter())
converter.register_converter(CSSSheet, CSSSheetConverter())


<div class="viewcode-block" id="Styled"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Styled.html#pyfeyn2.feynmandiagram.Styled">[docs]</a>@dataclass
class Styled:
    style: CSSString = field(
        default_factory=lambda: cssutils.parseStyle(&quot;&quot;),
        metadata={&quot;name&quot;: &quot;style&quot;, &quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;},
    )
    &quot;&quot;&quot;CSS style string.&quot;&quot;&quot;

    clazz: Optional[str] = field(
        default=None,
        metadata={&quot;name&quot;: &quot;class&quot;, &quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;},
    )
    &quot;&quot;&quot;CSS class string.&quot;&quot;&quot;

    def raw_style(self):
        return self.style.cssText.replace(&quot;\n&quot;, &quot; &quot;)

    def put_style(self, key, value):
        if self.style is not None:
            self.style.setProperty(key, value)
        return self

    def with_style(self, style):
        if style is not None:
            self.style = cssutils.parseStyle(style)
        return self

    def with_class(self, clazz):
        self.clazz = clazz
        return self</div>


<div class="viewcode-block" id="Bending"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Bending.html#pyfeyn2.feynmandiagram.Bending">[docs]</a>@dataclass
class Bending:
    bend: Optional[float] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )

<div class="viewcode-block" id="Bending.with_bend"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Bending.html#pyfeyn2.feynmandiagram.Bending.with_bend">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&#39;Use style=&quot;bend : true&quot;.&#39;)
    def with_bend(self, bend):
        self.bend = bend
        return self</div></div>


<div class="viewcode-block" id="Targeting"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Targeting.html#pyfeyn2.feynmandiagram.Targeting">[docs]</a>@dataclass
class Targeting:
    target: Optional[str] = field(default=&quot;&quot;, metadata={})
    &quot;&quot;&quot;Target of the object&quot;&quot;&quot;

    def with_target(self, target):
        if isinstance(target, str):
            self.target = target
        else:
            self.target = target.id
        return self

<div class="viewcode-block" id="Targeting.set_target"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Targeting.html#pyfeyn2.feynmandiagram.Targeting.set_target">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_target(self, *args, **kwargs):
        return self.with_target(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Sourcing"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Sourcing.html#pyfeyn2.feynmandiagram.Sourcing">[docs]</a>@dataclass
class Sourcing:
    source: Optional[str] = field(default=&quot;&quot;, metadata={})
    &quot;&quot;&quot;Source of the object&quot;&quot;&quot;

    def with_source(self, source):
        if isinstance(source, str):
            self.source = source
        else:
            self.source = source.id
        return self

<div class="viewcode-block" id="Sourcing.set_source"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Sourcing.html#pyfeyn2.feynmandiagram.Sourcing.set_source">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_source(self, *args, **kwargs):
        return self.with_source(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Line"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Line.html#pyfeyn2.feynmandiagram.Line">[docs]</a>@dataclass
class Line(Targeting, Sourcing):
    def connect(self, source, target):
        return self.with_source(source.id).with_target(target.id)</div>


<div class="viewcode-block" id="Vertex"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Vertex.html#pyfeyn2.feynmandiagram.Vertex">[docs]</a>@withify()
@dataclass
class Vertex(Labeled, Point, Styled, Identifiable):
    shape: Optional[str] = field(default=None, metadata={&quot;type&quot;: &quot;Attribute&quot;})
    &quot;&quot;&quot;Shape of the vertex&quot;&quot;&quot;</div>


# TODO think about withify for sub-classes
<div class="viewcode-block" id="Momentum"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Momentum.html#pyfeyn2.feynmandiagram.Momentum">[docs]</a>@dataclass
class Momentum:
    class Meta:
        name = &quot;momentum&quot;

    name: Optional[str] = field(default=None, metadata={&quot;type&quot;: &quot;Element&quot;})
    px: Optional[float] = field(default=None, metadata={&quot;type&quot;: &quot;Element&quot;})
    py: Optional[float] = field(default=None, metadata={&quot;type&quot;: &quot;Element&quot;})
    pz: Optional[float] = field(default=None, metadata={&quot;type&quot;: &quot;Element&quot;})
    e: Optional[float] = field(default=None, metadata={&quot;type&quot;: &quot;Element&quot;})</div>


<div class="viewcode-block" id="Connector"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Connector.html#pyfeyn2.feynmandiagram.Connector">[docs]</a>@withify()
@dataclass
class Connector(Labeled, Bending, Styled, PDG):
    momentum: Optional[Momentum] = field(
        default=None, metadata={&quot;name&quot;: &quot;momentum&quot;, &quot;type&quot;: &quot;Element&quot;}
    )
    &quot;&quot;&quot;Momentum of the connector&quot;&quot;&quot;
    tension: Optional[float] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;Tension of the connector&quot;&quot;&quot;
    length: Optional[float] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;Length of the connector&quot;&quot;&quot;

<div class="viewcode-block" id="Connector.set_momentum"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Connector.html#pyfeyn2.feynmandiagram.Connector.set_momentum">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_momentum(self, *args, **kwargs):
        return self.with_momentum(*args, **kwargs)</div>

<div class="viewcode-block" id="Connector.set_tension"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Connector.html#pyfeyn2.feynmandiagram.Connector.set_tension">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&#39;Use style=&quot;tension=&quot;.&#39;)
    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_tension(self, *args, **kwargs):
        return self.with_tension(*args, **kwargs)</div>

<div class="viewcode-block" id="Connector.set_length"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Connector.html#pyfeyn2.feynmandiagram.Connector.set_length">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&#39;Use style=&quot;tension=&quot;.&#39;)
    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_length(self, *args, **kwargs):
        return self.with_length(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Leg"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Leg.html#pyfeyn2.feynmandiagram.Leg">[docs]</a>@withify()
@dataclass
class Leg(Point, Targeting, Connector):
    sense: str = field(default=None, metadata={})
    &quot;&quot;&quot;Sense of the leg, either &#39;incoming&#39; or &#39;outgoing&#39;&quot;&quot;&quot;

    external: Optional[str] = field(
        default=None, metadata={&quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;}
    )
    &quot;&quot;&quot;External text for leg&quot;&quot;&quot;

    def with_incoming(self):
        self.sense = &quot;incoming&quot;
        return self

    def with_outgoing(self):
        self.sense = &quot;outgoing&quot;
        return self

<div class="viewcode-block" id="Leg.set_external"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Leg.html#pyfeyn2.feynmandiagram.Leg.set_external">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_external(self, *args, **kwargs):
        return self.with_external(*args, **kwargs)</div>

<div class="viewcode-block" id="Leg.set_incoming"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Leg.html#pyfeyn2.feynmandiagram.Leg.set_incoming">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_incoming(self, *args, **kwargs):
        return self.with_incoming(*args, **kwargs)</div>

<div class="viewcode-block" id="Leg.set_outgoing"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Leg.html#pyfeyn2.feynmandiagram.Leg.set_outgoing">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use with...().&quot;)
    def set_outgoing(self, *args, **kwargs):
        return self.with_outgoing(*args, **kwargs)</div></div>


<div class="viewcode-block" id="Propagator"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Propagator.html#pyfeyn2.feynmandiagram.Propagator">[docs]</a>@withify()
@dataclass
class Propagator(Line, Connector):
    pass</div>


<div class="viewcode-block" id="Label"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Label.html#pyfeyn2.feynmandiagram.Label">[docs]</a>@withify()
@dataclass
class Label(Point, Texted, Identifiable):
<div class="viewcode-block" id="Label.__init__"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Label.html#pyfeyn2.feynmandiagram.Label.__init__">[docs]</a>    @deprecated(version=&quot;2.0.7.1&quot;, reason=&quot;Use a orphaned Vertex with Label.&quot;)
    def __init__(self, *args, **kwargs):
        pass</div></div>


<div class="viewcode-block" id="FeynmanDiagram"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynmanDiagram.html#pyfeyn2.feynmandiagram.FeynmanDiagram">[docs]</a>@withify()
@dataclass
class FeynmanDiagram(Styled, Identifiable):
    class Meta:
        name = &quot;diagram&quot;

    default_style: Optional[bool] = field(
        default=True,
        metadata={&quot;name&quot;: &quot;default_style&quot;, &quot;xml_attribute&quot;: True, &quot;type&quot;: &quot;Attribute&quot;},
    )

    propagators: List[Propagator] = field(
        default_factory=list,
        metadata={&quot;name&quot;: &quot;propagator&quot;, &quot;type&quot;: &quot;Element&quot;, &quot;namespace&quot;: &quot;&quot;},
    )
    vertices: List[Vertex] = field(
        default_factory=list,
        metadata={&quot;name&quot;: &quot;vertex&quot;, &quot;type&quot;: &quot;Element&quot;, &quot;namespace&quot;: &quot;&quot;},
    )
    legs: List[Leg] = field(
        default_factory=list,
        metadata={&quot;name&quot;: &quot;leg&quot;, &quot;type&quot;: &quot;Element&quot;, &quot;namespace&quot;: &quot;&quot;},
    )
    labels: List[Label] = field(
        default_factory=list,
        metadata={&quot;name&quot;: &quot;label&quot;, &quot;type&quot;: &quot;Element&quot;, &quot;namespace&quot;: &quot;&quot;},
    )

    sheet: CSSSheet = field(
        default_factory=lambda: cssutils.parseString(&quot;&quot;),
        metadata={
            &quot;name&quot;: &quot;style&quot;,
            &quot;xml_attribute&quot;: True,
            &quot;type&quot;: &quot;Attribute&quot;,
            &quot;namespace&quot;: &quot;&quot;,
        },
    )

    def add(self, *fd_all: List[Union[Propagator, Vertex, Leg, Label]]):
        for a in fd_all:
            if isinstance(a, Propagator):
                self.propagators.append(a)
            elif isinstance(a, Vertex):
                self.vertices.append(a)
            elif isinstance(a, Leg):
                self.legs.append(a)
            elif isinstance(a, Label):
                self.labels.append(a)
            else:
                raise Exception(&quot;Unknown type: &quot; + str(type(a)) + &quot; &quot; + str(a))
        return self

    def get_vertex(self, idd):
        for v in self.vertices:
            if v.id == idd:
                return v
        for leg in self.legs:
            if leg.id == idd:
                return leg
        return None

    def get_connections(self, vertex):
        return [
            p
            for p in self.propagators
            if p.source == vertex.id or p.target == vertex.id
        ] + [leg for leg in self.legs if leg.target == vertex.id]

    def remove_propagator(self, propagator):
        self.propagators.remove(propagator)
        return self

    def get_bounding_box(self):
        min_x = 0
        min_y = 0
        max_x = 0
        max_y = 0
        for v in self.vertices:
            min_x = min(min_x, v.x)
            min_y = min(min_y, v.y)
            max_x = max(max_x, v.x)
            max_y = max(max_y, v.y)
        for leg in self.legs:
            min_x = min(min_x, leg.x)
            min_y = min(min_y, leg.y)
            max_x = max(max_x, leg.x)
            max_y = max(max_y, leg.y)
        return min_x, min_y, max_x, max_y

    def add_rule(self, rule: str):
        self.sheet.add(rule)
        return self

    def add_rules(self, rules: str):
        self.sheet = cssutils.parseString(
            self.sheet.cssText.decode(&quot;utf-8&quot;) + &quot;\n&quot; + rules
        )
        return self

    def with_rule(self, rule: str):
        return self.with_rules(rule)

    def with_rules(self, rules: str):
        self.sheet = cssutils.parseString(rules)
        return self

<div class="viewcode-block" id="FeynmanDiagram.get_style"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynmanDiagram.html#pyfeyn2.feynmandiagram.FeynmanDiagram.get_style">[docs]</a>    def get_style(self, obj) -&gt; cssutils.css.CSSStyleDeclaration:
        &quot;&quot;&quot;Get the style of an object.

        This is prefered over accessing the style attribute directly, sicne it includes class and pdgid definitions.
        &quot;&quot;&quot;
        # selectorText is string
        css = []
        # global style
        if isinstance(obj, Identifiable):
            css += [self._get_obj_style(obj)]
        if isinstance(obj, Styled):
            # specific attribute style
            css += [obj.style]
        return cssutils.css.CSSStyleDeclaration(
            cssText=&quot;;&quot;.join([c.cssText for c in css])
        )</div>

    def _get_obj_style(self, obj: Identifiable) -&gt; cssutils.css.CSSStyleDeclaration:
        document = etree.XML(self.to_xml().encode(&quot;ascii&quot;))

        def lambdaselector(s, obj=obj, document=document):
            try:
                expression = GenericTranslator().css_to_xpath(s)
            except SelectorError:
                warnings.warn(&quot;Invalid selector: &quot; + s)
                return False
            return obj.id in [e.get(&quot;id&quot;) for e in document.xpath(expression)]

        return self._get_style(lambdaselector)

    def _get_style(self, lambdaselector) -&gt; cssutils.css.CSSStyleDeclaration:

        ret = []

        if self.default_style:
            sheets = [get_default_sheet(), self.sheet]
        else:
            sheets = [self.sheet]
        for sheet in sheets:
            idd = []
            cls = []
            rest = []
            glob = []
            for rule in sheet:
                if rule.type == rule.STYLE_RULE:
                    s = rule.selectorText
                    if lambdaselector(s):
                        if s.startswith(&quot;#&quot;):
                            idd.append(rule)
                        elif s.startswith(&quot;[&quot;):
                            rest.append(rule)
                        elif s.startswith(&quot;:&quot;):
                            rest.append(rule)
                        elif s.startswith(&quot;*&quot;):
                            glob.append(rule)
                        elif &quot;.&quot; in s:
                            cls.append(rule)
                        else:
                            rest.append(rule)
            ret += reversed(idd + cls + rest + glob)
        # sort rules by priority
        return cssutils.css.CSSStyleDeclaration(
            cssText=&quot;;&quot;.join([r.style.cssText for r in ret])
        )

<div class="viewcode-block" id="FeynmanDiagram.to_xml"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynmanDiagram.html#pyfeyn2.feynmandiagram.FeynmanDiagram.to_xml">[docs]</a>    def to_xml(self) -&gt; str:
        &quot;&quot;&quot;Return self as XML.&quot;&quot;&quot;
        config = SerializerConfig(pretty_print=True)
        serializer = XmlSerializer(config=config)
        return serializer.render(self)</div>

<div class="viewcode-block" id="FeynmanDiagram.from_xml"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynmanDiagram.html#pyfeyn2.feynmandiagram.FeynmanDiagram.from_xml">[docs]</a>    @classmethod
    def from_xml(cls, xml: str):
        &quot;&quot;&quot;Load self from XML.&quot;&quot;&quot;
        parser = XmlParser()
        return parser.from_string(xml, cls)</div></div>


<div class="viewcode-block" id="Tool"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Tool.html#pyfeyn2.feynmandiagram.Tool">[docs]</a>@dataclass
class Tool:
    class Meta:
        name = &quot;tool&quot;

    name: Optional[str] = field(default=&quot;pyfeyn2&quot;, metadata={&quot;type&quot;: &quot;Element&quot;})
    version: Optional[str] = field(
        default=version(&quot;pyfeyn2&quot;), metadata={&quot;type&quot;: &quot;Element&quot;}
    )</div>


<div class="viewcode-block" id="Meta"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Meta.html#pyfeyn2.feynmandiagram.Meta">[docs]</a>@dataclass
class Meta:
    class Meta:
        name = &quot;meta&quot;

    name: Optional[str] = field(default=&quot;&quot;, metadata={&quot;type&quot;: &quot;Attribute&quot;})
    content: Optional[str] = field(default=&quot;&quot;, metadata={&quot;type&quot;: &quot;Attribute&quot;})</div>


alias_meta = Meta


<div class="viewcode-block" id="Head"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.Head.html#pyfeyn2.feynmandiagram.Head">[docs]</a>@dataclass
class Head:
    class Meta:
        name = &quot;head&quot;

    metas: List[alias_meta] = field(
        default_factory=list,
        metadata={&quot;name&quot;: &quot;meta&quot;, &quot;namespace&quot;: &quot;&quot;},
    )
    description: Optional[str] = field(default=&quot;&quot;, metadata={&quot;type&quot;: &quot;Element&quot;})

    style: Optional[str] = field(default=&quot;&quot;, metadata={&quot;type&quot;: &quot;Element&quot;})</div>


feynml_version = &quot;0.0&quot;


<div class="viewcode-block" id="FeynML"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynML.html#pyfeyn2.feynmandiagram.FeynML">[docs]</a>@dataclass
class FeynML:
    class Meta:
        name = &quot;feynml&quot;

    version: Optional[str] = field(
        default=feynml_version, metadata={&quot;name&quot;: &quot;version&quot;, &quot;type&quot;: &quot;Attribute&quot;}
    )

    # post init to check version
    def __post_init__(self):
        if self.version &lt; feynml_version:
            warnings.warn(&quot;FeynML version is older than this parser.&quot;)
        elif self.version &gt; feynml_version:
            warnings.warn(&quot;FeynML version is newer than this parser.&quot;)

        self.head.metas.append(Meta(&quot;pyfeyn2&quot;, version(&quot;pyfeyn2&quot;)))

    head: Optional[Head] = field(
        default=Head(), metadata={&quot;name&quot;: &quot;head&quot;, &quot;namespace&quot;: &quot;&quot;, &quot;type&quot;: &quot;Element&quot;}
    )

    diagrams: List[FeynmanDiagram] = field(
        default_factory=list,
        metadata={&quot;name&quot;: &quot;diagram&quot;, &quot;type&quot;: &quot;Element&quot;, &quot;namespace&quot;: &quot;&quot;},
    )

    def get_diagram(self, idd):
        for d in self.diagrams:
            if d.id == idd:
                return d
        return None

<div class="viewcode-block" id="FeynML.to_xml"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynML.html#pyfeyn2.feynmandiagram.FeynML.to_xml">[docs]</a>    def to_xml(self) -&gt; str:
        &quot;&quot;&quot;Return self as XML.&quot;&quot;&quot;
        config = SerializerConfig(pretty_print=True)
        serializer = XmlSerializer(config=config)
        return serializer.render(self)</div>

<div class="viewcode-block" id="FeynML.from_xml"><a class="viewcode-back" href="../../_autosummary/pyfeyn2.feynmandiagram.FeynML.html#pyfeyn2.feynmandiagram.FeynML.from_xml">[docs]</a>    @classmethod
    def from_xml(cls, xml: str):
        &quot;&quot;&quot;Load self from XML.&quot;&quot;&quot;
        parser = XmlParser()
        return parser.from_string(xml, cls)</div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Alexander Puck Neuwirth.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>